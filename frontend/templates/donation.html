<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Donate - FurMed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}" />
  <style>
    .navbar {
      background: #1a1a2e !important;
      padding: 0.8rem 1rem;
      transition: all 0.3s ease-in-out;
    }
    
    .donation-container {
      max-width: 800px;
      margin: 3rem auto;
      padding: 0 1rem;
    }
    body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    color: #212529;
    text-align: left;
    background-color: #beffad;
}
        /* Sticky Navbar */
    .sticky-navbar {
      background-color: rgba(26, 26, 46, 0.95) !important;
      padding: 15px 0;
      backdrop-filter: blur(10px);
    }

    .donation-header {
      background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
      color: white;
      padding: 2rem;
      border-radius: 10px;
      text-align: center;
      margin-bottom: 2rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .donation-header h2 {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }

    .donation-form {
      background-color: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: #2c3e50;
      font-weight: 500;
    }

    .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 5px;
      transition: border-color 0.2s;
    }

    .form-control:focus {
      border-color: #3498db;
      outline: none;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }

    .form-control.is-invalid {
      border-color: #e74c3c;
    }

    .error-message {
      display: none;
      color: #e74c3c;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

    .iti {
      width: 100%;
    }

    .iti__flag {
      background-image: url("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/img/flags.png");
    }

    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      .iti__flag {
        background-image: url("https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/img/flags@2x.png");
      }
    }

    .invoice-section {
      text-align: center;
      margin-top: 2rem;
      padding: 1rem;
      background-color: #f8f9fa;
      border-radius: 5px;
      display: none;
    }
    .success-message {
    background-color: #e6d600;
    color: #000000;
    padding: 1rem;
    border-radius: 5px;
    border-top-left-radius: 5px;
    border-top-right-radius: 5px;
    border-bottom-right-radius: 5px;
    border-bottom-left-radius: 5px;
    margin-bottom: 1rem;
    display: none;
}
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand" href="{{ url_for('route_home') }}">
            <i class="fas fa-paw mr-2"></i>FurMed
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link " href="{{ url_for('route_home') }}">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('route_disease') }}">Disease Analysis</a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="{{ url_for('route_services') }}">Other Services</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('route_about') }}">About Us</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

  <div class="container donation-container">
    <div class="donation-header">
      <h2>Make a Difference</h2>
      <p>Your donation helps us rescue, rehabilitate, and provide essential care for pets in need.</p>
    </div>

    <div id="success-alert" class="success-message"></div>

    <form id="donation-form" class="donation-form">
      <div class="form-group">
        <label for="name">Your Name</label>
        <input type="text" id="name" name="name" class="form-control" placeholder="Enter your name">
        <div class="error-message" id="name-error"></div>
      </div>

      <div class="form-group">
        <label for="email">Your Email</label>
        <input type="email" id="email" name="email" class="form-control" placeholder="Enter your email">
        <div class="error-message" id="email-error"></div>
      </div>

      <div class="form-group">
        <label for="phone">Phone Number</label>
        <input type="tel" id="phone" name="phone" class="form-control" placeholder="Enter your phone number">
        <div class="error-message" id="phone-error"></div>
      </div>

      <div class="form-group">
        <label for="address">Address</label>
        <textarea id="address" name="address" class="form-control" placeholder="Enter your address" rows="3"></textarea>
        <div class="error-message" id="address-error"></div>
      </div>

      <div class="form-group">
        <label for="amount">Donation Amount (INR)</label>
        <input type="number" id="amount" name="amount" class="form-control" placeholder="Enter amount (e.g., 500)">
        <div class="error-message" id="amount-error"></div>
      </div>

      <div id="paypal-button"></div>
    </form>

    <div id="invoice-section" class="invoice-section">
      <h5>Thank you for your donation!</h5>
      <a id="invoice-link" class="btn btn-success" href="#" target="_blank">
        <i class="fas fa-file-invoice"></i> Download Invoice
      </a>
    </div>
  </div>

 <!-- Footer -->
 <footer class="modern-footer mt-5">
  <div class="container">
    <div class="row g-4">
      <div class="col-md-4">
        <div class="footer-section">
          <h5 class="footer-heading accent-orange">About FurMed</h5>
          <p class="footer-text">
            Empowering pet owners with AI-driven health analysis and preventive care tips for their beloved companions.
          </p>
        </div>
      </div>

      <div class="col-md-4">
        <div class="footer-section">
          <h5 class="footer-heading accent-green">Contact Us</h5>
          <p class="footer-text">
            <i class="fas fa-envelope mr-2"></i>furmed.19@gmail.com<br>
            <i class="fas fa-phone mr-2"></i>+91 9359389335
          </p>
        </div>
      </div>

      <div class="col-md-4">
        <div class="footer-section">
          <h5 class="footer-heading accent-blue">Follow Us</h5>
          <div class="social-links">
           <a href="https://facebook.com/furmed" target="_blank" class="social-link facebook">
             <i class="fab fa-facebook-f"></i>
         </a>
         <a href="https://twitter.com/furmed" target="_blank" class="social-link twitter">
             <i class="fab fa-twitter"></i>
         </a>
         <a href="https://instagram.com/furmed" target="_blank" class="social-link instagram">
             <i class="fab fa-instagram"></i>
         </a>
         <a href="https://linkedin.com/company/furmed" target="_blank" class="social-link linkedin">
             <i class="fab fa-linkedin-in"></i>
         </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
  <script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&currency=USD"></script>

  <script>
// Initialize phone input
const phoneInput = document.getElementById('phone');
const iti = window.intlTelInput(phoneInput, {
    utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
    separateDialCode: true,
    initialCountry: "in",
    preferredCountries: ["in", "us", "gb", "ca", "au"],
    formatOnDisplay: true,
    nationalMode: true
});

// Form validation
const form = document.getElementById('donation-form');
const successAlert = document.getElementById('success-alert');

function showError(fieldId, message) {
    const errorDiv = document.getElementById(`${fieldId}-error`);
    const inputElement = document.getElementById(fieldId);
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
    inputElement.classList.add('is-invalid');
}

function hideError(fieldId) {
    const errorDiv = document.getElementById(`${fieldId}-error`);
    const inputElement = document.getElementById(fieldId);
    errorDiv.style.display = 'none';
    inputElement.classList.remove('is-invalid');
}

function validateForm() {
    let isValid = true;

    // Name validation
    const name = document.getElementById('name').value.trim();
    if (!name) {
        showError('name', 'Name is required');
        isValid = false;
    } else if (name.length < 2) {
        showError('name', 'Name must be at least 2 characters long');
        isValid = false;
    } else {
        hideError('name');
    }

    // Email validation
    const email = document.getElementById('email').value.trim();
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!email) {
        showError('email', 'Email is required');
        isValid = false;
    } else if (!emailRegex.test(email)) {
        showError('email', 'Please enter a valid email address');
        isValid = false;
    } else {
        hideError('email');
    }

    // Phone validation
    if (!phoneInput.value.trim()) {
        showError('phone', 'Phone number is required');
        isValid = false;
    } else if (!iti.isValidNumber()) {
        showError('phone', 'Please enter a valid phone number');
        isValid = false;
    } else {
        hideError('phone');
    }

    // Address validation
    const address = document.getElementById('address').value.trim();
    if (!address) {
        showError('address', 'Address is required');
        isValid = false;
    } else if (address.length < 10) {
        showError('address', 'Please enter a complete address');
        isValid = false;
    } else {
        hideError('address');
    }

    // Amount validation
    const amount = document.getElementById('amount').value.trim();
    if (!amount) {
        showError('amount', 'Amount is required');
        isValid = false;
    } else if (isNaN(amount) || parseFloat(amount) <= 0) {
        showError('amount', 'Please enter a valid amount');
        isValid = false;
    } else if (parseFloat(amount) < 100) { // Minimum donation amount
        showError('amount', 'Minimum donation amount is INR 100');
        isValid = false;
    } else {
        hideError('amount');
    }

    return isValid;
}

// Real-time validation
document.querySelectorAll('input, textarea').forEach(input => {
    input.addEventListener('input', function() {
        if (this.classList.contains('is-invalid')) {
            hideError(this.id);
        }
    });
});

// Format phone number on blur
phoneInput.addEventListener('blur', function() {
    if (phoneInput.value.trim()) {
        if (iti.isValidNumber()) {
            phoneInput.value = iti.getNumber();
        }
    }
});

// PayPal integration
paypal.Buttons({
    createOrder: function(data, actions) {
        if (!validateForm()) {
            return false;
        }

        const inrAmount = document.getElementById("amount").value;
        return fetch('/convert-inr-to-usd', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ amount_inr: inrAmount })
        })
        .then(res => res.json())
        .then(data => {
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        value: data.amount_usd,
                        currency_code: "USD"
                    }
                }]
            });
        })
        .catch(error => {
            console.error('Error creating order:', error);
            alert('There was an error processing your request. Please try again.');
            return false;
        });
    },

    onApprove: function(data, actions) {
        return actions.order.capture()
        .then(function(details) {
            // Get formatted phone number
            const phoneNumber = iti.getNumber(intlTelInputUtils.numberFormat.E164);
            
            // Prepare payment data
            const paymentData = {
                orderID: data.orderID,
                phone: phoneNumber,
                address: document.getElementById("address").value.trim()
            };

            // Send to server
            return fetch('/paypal-success', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(paymentData)
            })
            .then(response => response.json())
            .then(result => {
                if (result.status === "success") {
                    // Show success message
                    successAlert.textContent = `Thank you, ${details.payer.name.given_name}! Your donation was successful.`;
                    successAlert.style.display = 'block';
                    
                    // Show invoice section
                    document.getElementById("invoice-section").style.display = "block";
                    document.getElementById("invoice-link").href = result.invoice_url;
                    
                    // Reset form
                    form.reset();
                    iti.setCountry("in");
                } else {
                    throw new Error(result.message || 'Payment processing failed');
                }
            });
        })
        .catch(error => {
            console.error('Payment Error:', error);
            alert("Error processing payment: " + error.message);
        });
    },

    onError: function(err) {
        console.error('PayPal Error:', err);
        alert('There was an error with PayPal. Please try again later.');
    }
}).render("#paypal-button");

// Prevent form submission on enter key
form.addEventListener('keypress', function(e) {
    if (e.keyCode === 13 || e.which === 13) {
        e.preventDefault();
        return false;
    }
});
  </script>
</body>
</html>